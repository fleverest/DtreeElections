<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Perform ballot-polling Bayesian audits for ranked voting elections
    using a Dirichlet-tree prior distribution.">
<title>Ranked Voting Election Audits with Dirichlet-Trees • elections.dtree</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Ranked Voting Election Audits with Dirichlet-Trees">
<meta property="og:description" content="Perform ballot-polling Bayesian audits for ranked voting elections
    using a Dirichlet-tree prior distribution.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">elections.dtree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/fleverest/elections.dtree/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ranked-voting-election-audits-with-dirichlet-trees">Ranked Voting Election Audits with Dirichlet-Trees<a class="anchor" aria-label="anchor" href="#ranked-voting-election-audits-with-dirichlet-trees"></a>
</h1></div>
<p>Perform ballot-polling Bayesian audits for ranked voting elections using a Dirichlet-tree prior distribution.</p>
<p><!-- badges: start --> <a href="https://github.com/fleverest/elections.dtree/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/fleverest/elections.dtree/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://app.codecov.io/gh/fleverest/elections.dtree?branch=main" class="external-link"><img src="https://codecov.io/gh/fleverest/elections.dtree/branch/main/graph/badge.svg" alt="Codecov test coverage"></a> <!-- badges: end --></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level4">
<h4 id="cran">CRAN<a class="anchor" aria-label="anchor" href="#cran"></a>
</h4>
<p>TBD</p>
</div>
<div class="section level4">
<h4 id="development">Development<a class="anchor" aria-label="anchor" href="#development"></a>
</h4>
<p>To install the development version of <code>elections.dtree</code> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("remotes")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"fleverest/elections.dtree"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="about-the-project">About the project<a class="anchor" aria-label="anchor" href="#about-the-project"></a>
</h2>
<div class="section level4">
<h4 id="why">Why?<a class="anchor" aria-label="anchor" href="#why"></a>
</h4>
<p>Bayesian audits of elections typically employ a Dirichlet prior, conjugate to a multinomial distribution for the observed ballots. For ranked voting systems, the number of ballot types can grow factorially. In the case of instant-runoff voting (IRV), a popular type of ranked voting system, the number of possible ballot types is <code>n!</code> with <code>n</code> candidates (assuming all candidates are ranked; it is even greater if partially completed ballots are permitted).</p>
<p>The Dirichlet distribution is a simple and effective choice if the number of ballot types is small, but becomes problematic when this number gets large. As <code>n</code> grows, the prior concentration parameters (defined by <code>a0</code> in our implementation) need to be on the order of <code>1 / n!</code> to ensure the prior is not overly informative. If <code>n</code> is large enough, this may be smaller than the available floating-point precision. Also, the fact that this varies by <code>n</code> is inconvenient. A more practical alternative is given by the Dirichlet-tree distribution, which we implement in this package.</p>
<p>The Dirichlet-tree distribution consists of nested Dirichlet distributions, arranged hierarchically in a tree structure. The structure represents the preference ordering of the candidates. Branches coming out of each node correspond to choices for which candidate to select as the next preferred, and nodes represent a ranking of candidates (a complete ranking for leaf nodes, and an incomplete ranking for internal nodes). We place a Dirichlet distribution at each node, to model the conditional split of preferences at that node. The structure as a whole then defines a Dirichlet-tree distribution. Just like the Dirichlet, it is conjugate to a multinomial distribution. Also, the Dirichlet-tree is a generalisation, including a Dirichlet as a special case.</p>
<p>Using the Dirichlet-tree as a prior distribution allows it to scale efficiently to large <code>n</code>, and does not require setting the concentration parameters (<code>a0</code>) to values that depend on <code>n</code> to perform well. depend on <code>n</code> to perform well.</p>
</div>
<div class="section level4">
<h4 id="how">How?<a class="anchor" aria-label="anchor" href="#how"></a>
</h4>
<p>In this package, the tree structure is implemented such that the nodes are only initialised when they appear in the observed ballot data (i.e. when at least one of the ballots includes a preference sequence that is represented by that node). This allows the memory-complexity to be <code>O(n*m)</code>, where <code>m</code> is the number of ballots observed in the audit process.</p>
<p>Without such lazy evaluation, the memory-complexity is necessarily <code>O(n!)</code>. Hence, our implementation of the Dirichlet distribution (based on a reducible Dirichlet-tree structure) enables a larger set of candidates than would be possible using traditional methods.</p>
<p>To sample unseen ballots without loading all nodes into memory, this repository implements a recursive strategy that generates samples starting from any uninitialized point in the tree. This works well for IRV ballot structures, since the permutation-tree structure is easily navigated given a target ballot.</p>
<p>Currently, only IRV elections have been implemented, but other ranked voting systems could be supported by implementing the corresponding social choice function.</p>
<p>In order to support different tree structures or other elections which deal with high cardinality, a similar recursive strategy for sampling should be developed (and anyone designing a new tree structure should consider this carefully).</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level4">
<h4 id="s3-interface">S3 interface<a class="anchor" aria-label="anchor" href="#s3-interface"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize a new Dirichlet-tree for IRV elections with</span></span>
<span><span class="co"># 26 candidates (named A through Z), requiring exactly 3 preferences</span></span>
<span><span class="co"># specified for a valid ballot, and using a prior parameter of 1.5.</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dirtree.html">dirtree</a></span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="va">LETTERS</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create some generic ballots.</span></span>
<span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ranked_ballots.html">ranked_ballots</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span>, candidates <span class="op">=</span> <span class="va">LETTERS</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample 1000 random ballots from the tree.</span></span>
<span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sample_predictive.html">sample_predictive</a></span><span class="op">(</span><span class="va">dtree</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check which candidate wins the simulated election.</span></span>
<span><span class="fu"><a href="reference/social_choice.html">social_choice</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Shuffle the ballots.</span></span>
<span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Observe the first 100 ballots to obtain a posterior Dirichlet-tree.</span></span>
<span><span class="fu"><a href="reference/update.html">update</a></span><span class="op">(</span><span class="va">dtree</span>, <span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate 100 random election outcomes by:</span></span>
<span><span class="co">#  1. sampling 900 ballots from the posterior predictive distribution, and</span></span>
<span><span class="co">#  2. evaluating the outcome of the 900 total sampled ballots, plus the 100 observed.</span></span>
<span><span class="fu"><a href="reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">dtree</span>, n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change the prior parameter and compare the posterior winning probabilities.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="va">a0</span> <span class="op">&lt;-</span> <span class="fl">1.</span></span>
<span><span class="fu"><a href="reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">dtree</span>, n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Do it again, with a Dirichlet prior this time!</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="va">vd</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="fu"><a href="reference/sample_posterior.html">sample_posterior</a></span><span class="op">(</span><span class="va">dtree</span>, n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset the distribution to the prior, removing observed data. This is equivalent to</span></span>
<span><span class="co"># creating a new tree with the same parameters.</span></span>
<span><span class="fu"><a href="reference/reset.html">reset</a></span><span class="op">(</span><span class="va">dtree</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="r6-interface">R6 interface<a class="anchor" aria-label="anchor" href="#r6-interface"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize a new Dirichlet-tree for IRV elections with</span></span>
<span><span class="co"># 26 candidates (named A through Z), requiring exactly 3 preferences</span></span>
<span><span class="co"># specified for a valid ballot, and using a prior parameter of 1.5.</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="va">LETTERS</span>,</span>
<span>  min_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  max_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  a0 <span class="op">=</span> <span class="fl">1.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Sample 1000 random ballots from the tree.</span></span>
<span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="va">dtree</span><span class="op">$</span><span class="fu">sample_predictive</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check which candidate wins the simulated election.</span></span>
<span><span class="fu"><a href="reference/social_choice.html">social_choice</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Shuffle the ballots.</span></span>
<span><span class="va">ballots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">ballots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Observe the first 100 ballots to obtain a posterior Dirichlet-tree.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="va">ballots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate 100 random election outcomes by:</span></span>
<span><span class="co">#  1. sampling 900 ballots from the posterior predictive distribution, and</span></span>
<span><span class="co">#  2. evaluating the outcome of the 900 total sampled ballots, plus the 100 observed.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">sample_posterior</span><span class="op">(</span>n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Change the prior parameter and compare the posterior winning probabilities.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="va">a0</span> <span class="op">&lt;-</span> <span class="fl">1.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">sample_posterior</span><span class="op">(</span>n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Do it again, with a Dirichlet prior this time!</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="va">vd</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">sample_posterior</span><span class="op">(</span>n_elections <span class="op">=</span> <span class="fl">100</span>, n_ballots <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reset the distribution to the prior, removing observed data. This is equivalent to</span></span>
<span><span class="co"># creating a new tree with the same parameters.</span></span>
<span><span class="va">dtree</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Additionally, the R6 interface allows you to chain commands.</span></span>
<span><span class="va">dtree</span> <span class="op">&lt;-</span> <span class="va"><a href="reference/dirichlet_tree.html">dirichlet_tree</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  candidates <span class="op">=</span> <span class="va">LETTERS</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/ranked_ballots.html">ranked_ballots</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    candidates <span class="op">=</span> <span class="va">LETTERS</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/fleverest/elections.dtree/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/fleverest/elections.dtree/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing elections.dtree</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Floyd Everest <br><small class="roles"> Author, maintainer, copyright holder </small> <a href="https://orcid.org/0000-0002-2726-6736" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Damjan Vukcevic <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-7780-9586" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Floyd Everest, Damjan Vukcevic.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
